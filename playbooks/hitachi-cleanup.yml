---
- name: Cleanup Hitachi SDS Resources
  hosts: all
  gather_facts: no
  
  vars_files:
    - "{{ playbook_dir }}/../hitachi.overrides.yml"

  tasks:
    - name: Delete test volumes
      debug:
        msg: "Deleting test volumes..."

    - name: Uninstall CSI driver
      shell: |
        helm uninstall hitachi-csi -n {{ hitachi_csi_namespace }} || true
      changed_when: false
      ignore_errors: yes

    - name: Remove storage pools
      debug:
        msg: "Removing storage pools..."

    - name: Stop SDS services
      shell: |
        systemctl stop hitachi-sds || true
      become: yes
      ignore_errors: yes

    - name: Cleanup node configuration
      debug:
        msg: "Cleaning up node configuration..."

    - name: Display cleanup complete
      debug:
        msg: |
          âœ… Cleanup complete!
          Use 'terraform destroy' to remove infrastructure
